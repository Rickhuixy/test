<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style type="text/css">
    html {
      height: 100%
    }

    body {
      height: 100%;
      margin: 0px;
      padding: 0px
    }

    #container {
      height: 100%;
      z-index: 0;
    }

    .search {
      position: fixed;
      top: 20px;
      left: 35%;
      z-index: 1;
    }

    .search input {
      width: 200px;
    }
  </style>
  <script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=GDwCI9DXCGmRjrt2D3AG1Y4yTsz8KNwQ"></script>
  <script src="/lib/jquery-1.12.4.min.js"></script>
  <script src="/lib/vue-2.6.12.js"></script>
</head>

<body>
  <div class="search">
    <input type="text" :placeholder="输入地点搜索" id="ipt">
    <button id="btn">搜索</button>

  </div>

  <div id="container"></div>


  <script>
    let word = ''
    var map = new BMap.Map("container");
    let storage = window.localStorage;
    map.enableScrollWheelZoom(true); //开启鼠标滚轮缩放
    var geolocation = new BMap.Geolocation();
    // geolocation.getCurrentPosition(function (r) {
    //   if (this.getStatus() == BMAP_STATUS_SUCCESS) {
    //     var mk = new BMap.Marker(r.point);
    //     map.addOverlay(mk);
    //     map.panTo(r.point);

    //     alert('您的位置：' + r.point.lng + ',' + r.point.lat);
    //     console.log(r.point.lng);
    var lng = localStorage.getItem("r.point.lng")
    var lat = localStorage.getItem("r.point.lat")
    var point = new BMap.Point(lng, lat);
    console.log(point);
    map.centerAndZoom(new BMap.Point(lng, lat), 17);

    var geoc = new BMap.Geocoder();
    map.addEventListener("click", function (e) {
      var pt = e.point;
      geoc.getLocation(pt, function (rs) {
        var addComp = rs.addressComponents;
        var flag
        flag = confirm('搜索地点:' + addComp.province + ", " + addComp.city + ", " + addComp.district + ", " +
          addComp
          .street +
          ", " + addComp.streetNumber);
        if (flag) {


          location.href = './searchList.html'
        }
      });
    });

    map.addControl(new BMap.NavigationControl());
    map.addControl(new BMap.ScaleControl());
    map.addControl(new BMap.OverviewMapControl());
    map.addControl(new BMap.MapTypeControl());
    map.setCurrentCity("成都"); // 仅当设置城市信息时，MapTypeControl的切换功能才能可用   


    window.setTimeout(function () {
      map.panTo(new BMap.Point(lng, lat));
    }, 2000);



    $(function () {
      $('#btn').on('click', function () {
        getSuggestList($('#ipt').val().trim())
        word = $('#ipt').val().trim()
        storage["search_word"] = word;
        $('#ipt').val('点击地图选择搜索点')
      })

      function getSuggestList(kw) {
        $.ajax({
          url: 'https://api.map.baidu.com/place/v2/suggestion?query=' + kw +
            '&region=成都&city_limit=true&output=json&ak=GDwCI9DXCGmRjrt2D3AG1Y4yTsz8KNwQ',
          dataType: 'jsonp',
          success: function (res) {
            console.log(res.result[0].location)
            map.centerAndZoom(new BMap.Point(res.result[0].location.lng, res.result[0].location.lat), 17);
            map.panTo(new BMap.Point(res.result[0].location.lng, res.result[0].location.lat));

          }
        })
        // console.log(keywords);

      }
    })
  </script>
</body>

</html>